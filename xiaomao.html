<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ´›å…‹ç‹å›½é£æ ¼ - å® ç‰©PKå¯¹æˆ˜</title>
    <style>
        /* å…¨å±€æ ·å¼ - ä»¿æ´›å…‹ç‹å›½å¤å¤ç«¥è¯é£æ ¼ */
        * {
            margin: 0;
            padding: 0;
            font-family: "Microsoft YaHei", "å¹¼åœ†", "Comic Sans MS", serif;
            box-sizing: border-box;
        }
        body {
            background: linear-gradient(135deg, #0a1931 0%, #1a1a2e 50%, #16213e 100%); /* æ·±è‰²æ¸å˜èƒŒæ™¯ */
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px 0;
        }

        /* å® ç‰©é€‰æ‹©ç•Œé¢ */
        .pet-select-container {
            width: 900px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 10px solid #d4b16a;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 0 50px rgba(212, 177, 106, 0.8);
            display: none;
            flex-direction: column;
            align-items: center;
        }
        .select-title {
            color: #ffd700;
            font-size: 32px;
            margin-bottom: 30px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .pet-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            width: 100%;
        }
        .pet-option {
            background: linear-gradient(135deg, rgba(30, 30, 60, 0.85) 0%, rgba(10, 10, 40, 0.85) 100%);
            border: 3px solid #ffd700;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .pet-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3), 0 0 20px rgba(255, 215, 0, 0.5);
        }
        .pet-option.selected {
            border-color: #ff6600;
            box-shadow: 0 0 20px rgba(255, 102, 0, 0.8);
        }
        .pet-option-img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 5px solid #fff;
            object-fit: cover;
            margin-bottom: 15px;
        }
        .pet-option-name {
            color: #ffd700;
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .pet-option-level {
            color: #99ccff;
            margin-bottom: 10px;
        }
        .pet-option-hp {
            color: #ff6666;
            margin-bottom: 10px;
        }
        .pet-option-desc {
            color: #fff;
            text-align: center;
            font-size: 14px;
            margin-bottom: 15px;
        }
        .pet-option-skills {
            width: 100%;
        }
        .skill-item {
            color: #e0e0e0;
            font-size: 13px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }
        .start-battle-btn {
            margin-top: 30px;
            padding: 12px 40px;
            background: linear-gradient(135deg, #ff6600 0%, #ff4500 50%, #e03e00 100%);
            border: none;
            border-radius: 15px;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 6px 0 #b33c00, 0 8px 15px rgba(0,0,0,0.3);
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .start-battle-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 0 #b33c00, 0 10px 20px rgba(0,0,0,0.4);
        }

        /* å¯¹æˆ˜ä¸»å®¹å™¨ - å¸¦æœ¨çº¹è¾¹æ¡†+å†…å‘å…‰ */
        .battle-container {
            width: 1100px;
            height: 720px;
            background: url("https://ts4.tc.mm.bing.net/th/id/OIP-C.QnH_ONh4t19UJ5GuYK1ODAHaEU?rs=1&pid=ImgDetMain&o=7&rm=3") no-repeat center center;
            background-size: cover;
            border: 10px solid #d4b16a;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(212, 177, 106, 0.8), inset 0 0 20px rgba(0,0,0,0.2);
            display: none;
        }

        /* å® ç‰©ç«™ä½åŒºåŸŸ - åŠé€æ˜é®ç½©ï¼Œä¸é®æŒ¡èƒŒæ™¯å›¾ */
        .pet-area {
            width: 100%;
            height: 420px;
            display: flex;
            justify-content: space-between;
            padding: 30px;
            position: relative;
            background: rgba(255, 255, 255, 0.15); /* åŠé€æ˜é®ç½©ï¼Œä¿ç•™èƒŒæ™¯å›¾å¯è§ */
        }

        /* å® ç‰©å¡ç‰‡ - è°ƒæ•´å¸ƒå±€ï¼Œé¿å…é®æŒ¡è¡€æ¡ */
        .pet-card {
            width: 380px; /* åŠ å®½å¡ç‰‡ */
            height: 380px;
            position: relative;
            filter: drop-shadow(0 0 15px rgba(0,0,0,0.2));
            display: flex;
            flex-direction: column;
        }
        .player-pet {
            align-items: flex-start;
            justify-content: flex-end;
        }
        .enemy-pet {
            align-items: flex-end;
            justify-content: flex-start;
        }

        /* å® ç‰©å½¢è±¡ - è°ƒæ•´ä½ç½®ï¼Œå®Œå…¨é¿å¼€è¡€æ¡é¢æ¿ */
        .pet-img {
            width: 240px;
            height: 240px;
            border-radius: 50%;
            border: 8px solid #fff;
            box-shadow: 
                0 0 0 4px #ffd700,
                0 0 20px rgba(255, 215, 0, 0.6),
                0 0 40px rgba(255, 215, 0, 0.3);
            background: linear-gradient(45deg, #f8f8f8, #e8e8e8);
            object-fit: cover;
            transition: all 0.3s ease;
            position: relative;
            z-index: 5;
        }
        .player-pet .pet-img {
            margin-top: 10px; /* ä¸‹ç§»å›¾ç‰‡ï¼Œé¿å¼€ä¸Šæ–¹è¡€æ¡ */
        }
        .enemy-pet .pet-img {
            margin-bottom: 10px; /* ä¸Šç§»å›¾ç‰‡ï¼Œé¿å¼€ä¸‹æ–¹è¡€æ¡ */
        }
        /* å® ç‰©å—å‡»/å›è¡€ç‰¹æ•ˆ */
        .pet-img.attack-effect {
            animation: attackShake 0.5s ease;
        }
        .pet-img.heal-effect {
            animation: healGlow 0.8s ease;
        }
        .pet-img.control-effect {
            animation: controlBlur 1s ease;
        }

        /* å® ç‰©ä¿¡æ¯é¢æ¿ - è°ƒæ•´å±‚çº§å’Œä½ç½®ï¼Œç¡®ä¿ä¸è¢«é®æŒ¡ */
        .pet-info {
            width: 320px;
            height: 90px;
            background: linear-gradient(135deg, rgba(30, 30, 60, 0.85) 0%, rgba(10, 10, 40, 0.85) 100%);
            border-radius: 15px;
            padding: 12px 15px;
            color: #fff;
            position: relative;
            box-shadow: 0 8px 0 rgba(0,0,0,0.2), inset 0 2px 0 rgba(255,255,255,0.1);
            border: 2px solid #ffd700;
            z-index: 6; /* æé«˜å±‚çº§ï¼Œç¡®ä¿åœ¨å›¾ç‰‡ä¸Šæ–¹ */
            margin-bottom: 15px; /* ç©å®¶è¡€æ¡ä¸å›¾ç‰‡é—´è· */
        }
        .enemy-pet .pet-info {
            margin-top: 15px; /* æ•Œæ–¹è¡€æ¡ä¸å›¾ç‰‡é—´è· */
        }
        .pet-name {
            font-size: 22px;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 6px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .pet-level {
            font-size: 16px;
            color: #99ccff;
            margin-bottom: 8px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        /* HPè¡€æ¡å®¹å™¨ */
        .hp-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .hp-label {
            font-size: 16px;
            color: #ff6666;
            font-weight: bold;
        }
        .hp-bar {
            flex: 1;
            height: 18px;
            background: linear-gradient(135deg, #222 0%, #333 100%);
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #666;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }
        .hp-fill {
            height: 100%;
            background: linear-gradient(135deg, #ff6666 0%, #ff4444 50%, #ff2222 100%);
            border-radius: 6px;
            transition: width 0.5s ease;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.3);
        }
        .hp-text {
            font-size: 14px;
            color: #fff;
            min-width: 70px;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(255,255,255,0.5);
        }

        /* æˆ˜æ–—æ—¥å¿—åŒºåŸŸ - ç§»è‡³å® ç‰©åŒºä¸‹æ–¹ã€æŠ€èƒ½æ± ä¸Šæ–¹ */
        .battle-log-wrapper {
            width: 100%;
            height: 110px;
            padding: 0 20px;
            background: rgba(155, 123, 72, 0.4); /* åŠé€æ˜æœ¨çº¹é®ç½© */
            border-top: 2px solid #d4b16a;
            border-bottom: 2px solid #d4b16a;
        }
        .battle-log {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0,0,0,0.7) 0%, rgba(20,20,40,0.7) 100%);
            border-radius: 15px;
            padding: 12px 15px;
            color: #fff;
            font-size: 15px;
            overflow-y: auto;
            z-index: 10;
            border: 2px solid #ffd700;
            box-shadow: 0 8px 15px rgba(0,0,0,0.3);
        }
        /* æ—¥å¿—æ»šåŠ¨æ¡ç¾åŒ– */
        .battle-log::-webkit-scrollbar {
            width: 8px;
        }
        .battle-log::-webkit-scrollbar-track {
            background: #333;
            border-radius: 4px;
        }
        .battle-log::-webkit-scrollbar-thumb {
            background: #ffd700;
            border-radius: 4px;
        }

        /* æŠ€èƒ½æ± åŒºåŸŸ - æ´›å…‹ç‹å›½ç»å…¸æœ¨çº¹+é‡‘è‰²é•¶è¾¹ */
        .skill-pool {
            width: 100%;
            height: 230px;
            background: linear-gradient(180deg, #9b7b48 0%, #8b6914 50%, #7a5a00 100%);
            border-top: 8px solid #d4b16a;
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            box-shadow: inset 0 4px 10px rgba(0,0,0,0.3);
            position: relative;
            z-index: 8;
        }

        /* æŠ€èƒ½æŒ‰é’® - å…¨æ–°ç²¾ç¾è®¾è®¡ */
        .skill-btn {
            background: linear-gradient(135deg, #4a90e2 0%, #2962ff 50%, #1a4999 100%);
            border: none;
            border-radius: 15px;
            padding: 15px 10px;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 6px 0 #1a4999,
                0 8px 15px rgba(0,0,0,0.3),
                inset 0 2px 0 rgba(255,255,255,0.3);
            position: relative;
            overflow: hidden;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        /* æŠ€èƒ½å›¾æ ‡ */
        .skill-icon {
            font-size: 28px;
            margin-bottom: 8px;
            text-shadow: 0 0 10px currentColor;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }
        /* æŠ€èƒ½åç§° */
        .skill-name {
            font-size: 16px;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
            text-align: center;
        }
        /* æŠ€èƒ½è¯¦æƒ… */
        .skill-details {
            display: flex;
            justify-content: space-between;
            width: 100%;
            font-size: 14px;
            padding: 0 5px;
        }
        .skill-pp, .skill-power {
            display: flex;
            align-items: center;
            gap: 3px;
            color: #ffff99;
            font-weight: bold;
        }
        .skill-power {
            color: #ff9999;
        }
        /* æŠ€èƒ½æŒ‰é’®çº¹ç† */
        .skill-btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 50%);
            pointer-events: none;
        }
        .skill-btn:disabled {
            background: linear-gradient(135deg, #888 0%, #666 50%, #444 100%);
            cursor: not-allowed;
            box-shadow: 0 6px 0 #444, 0 8px 15px rgba(0,0,0,0.3);
            opacity: 0.7;
            transform: translateY(2px);
        }
        .skill-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 
                0 8px 0 #1a4999,
                0 12px 20px rgba(0,0,0,0.4),
                0 0 20px rgba(74, 144, 226, 0.5);
        }
        .skill-btn:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 
                0 4px 0 #1a4999,
                0 6px 10px rgba(0,0,0,0.3);
        }
        /* æŠ€èƒ½ç±»å‹ç‰¹å®šæ ·å¼ */
        .skill-btn[data-type="attack"] {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 50%, #a04000 100%);
            box-shadow: 0 6px 0 #a04000, 0 8px 15px rgba(0,0,0,0.3);
        }
        .skill-btn[data-type="attack"]:hover:not(:disabled) {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 50%, #d35400 100%);
            box-shadow: 0 8px 0 #a04000, 0 12px 20px rgba(0,0,0,0.4), 0 0 20px rgba(230, 126, 34, 0.5);
        }
        .skill-btn[data-type="magic"] {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 50%, #6c3483 100%);
            box-shadow: 0 6px 0 #6c3483, 0 8px 15px rgba(0,0,0,0.3);
        }
        .skill-btn[data-type="magic"]:hover:not(:disabled) {
            background: linear-gradient(135deg, #af7ac5 0%, #9b59b6 50%, #8e44ad 100%);
            box-shadow: 0 8px 0 #6c3483, 0 12px 20px rgba(0,0,0,0.4), 0 0 20px rgba(155, 89, 182, 0.5);
        }
        .skill-btn[data-type="heal"] {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 50%, #1e8449 100%);
            box-shadow: 0 6px 0 #1e8449, 0 8px 15px rgba(0,0,0,0.3);
        }
        .skill-btn[data-type="heal"]:hover:not(:disabled) {
            background: linear-gradient(135deg, #58d68d 0%, #2ecc71 50%, #27ae60 100%);
            box-shadow: 0 8px 0 #1e8449, 0 12px 20px rgba(0,0,0,0.4), 0 0 20px rgba(46, 204, 113, 0.5);
        }
        .skill-btn[data-type="control"] {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 50%, #1f618d 100%);
            box-shadow: 0 6px 0 #1f618d, 0 8px 15px rgba(0,0,0,0.3);
        }
        .skill-btn[data-type="control"]:hover:not(:disabled) {
            background: linear-gradient(135deg, #5dade2 0%, #3498db 50%, #2980b9 100%);
            box-shadow: 0 8px 0 #1f618d, 0 12px 20px rgba(0,0,0,0.4), 0 0 20px rgba(52, 152, 219, 0.5);
        }
        .skill-btn[data-type="self-damage"] {
            background: linear-gradient(135deg, #7f8c8d 0%, #555 50%, #333 100%);
            box-shadow: 0 6px 0 #333, 0 8px 15px rgba(0,0,0,0.3);
        }
        .skill-btn[data-type="self-damage"]:hover:not(:disabled) {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 50%, #555 100%);
            box-shadow: 0 8px 0 #333, 0 12px 20px rgba(0,0,0,0.4), 0 0 20px rgba(127, 140, 141, 0.5);
        }
        .skill-btn[data-type="ultimate"] {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 50%, #922b1f 100%);
            box-shadow: 0 6px 0 #922b1f, 0 8px 15px rgba(0,0,0,0.3);
        }
        .skill-btn[data-type="ultimate"]:hover:not(:disabled) {
            background: linear-gradient(135deg, #ff6b6b 0%, #e74c3c 50%, #c0392b 100%);
            box-shadow: 0 8px 0 #922b1f, 0 12px 20px rgba(0,0,0,0.4), 0 0 30px rgba(231, 76, 60, 0.7);
        }

        /* å›åˆæç¤º - æ‚¬æµ®æ°”æ³¡+å‘å…‰ç‰¹æ•ˆ */
        .round-tip {
            position: absolute;
            top: 180px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 25px;
            background: linear-gradient(135deg, #ffd700 0%, #ffc107 100%);
            color: #8b4513;
            font-weight: bold;
            font-size: 18px;
            border-radius: 30px;
            display: none;
            z-index: 15;
            box-shadow: 
                0 4px 15px rgba(255, 215, 0, 0.6),
                0 0 20px rgba(255, 215, 0, 0.4);
            text-shadow: 0 1px 2px rgba(255,255,255,0.5);
            border: 2px solid #fff;
            animation: tipFloat 2s ease-in-out infinite;
        }

        /* èƒœåˆ©/å¤±è´¥æç¤ºå¼¹çª— - é­”æ³•å¼¹çª—é£æ ¼ */
        .result-modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 450px;
            height: 220px;
            background: linear-gradient(135deg, rgba(0,0,0,0.9) 0%, rgba(30,30,60,0.9) 100%);
            border: 8px solid #ffd700;
            border-radius: 25px;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #fff;
            z-index: 20;
            box-shadow: 
                0 0 50px rgba(255, 215, 0, 0.8),
                inset 0 0 30px rgba(255, 215, 0, 0.3);
        }
        .result-text {
            font-size: 32px;
            margin-bottom: 25px;
            color: #ff6600;
            font-weight: bold;
            text-shadow: 0 2px 10px rgba(255, 102, 0, 0.8);
            animation: resultPulse 1.5s ease-in-out infinite;
        }
        .restart-btn {
            padding: 12px 40px;
            background: linear-gradient(135deg, #ff6600 0%, #ff4500 50%, #e03e00 100%);
            border: none;
            border-radius: 15px;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 
                0 6px 0 #b33c00,
                0 8px 15px rgba(0,0,0,0.3);
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }
        .restart-btn:hover {
            background: linear-gradient(135deg, #ff8800 0%, #ff6600 50%, #ff4500 100%);
            transform: translateY(-3px);
            box-shadow: 
                0 8px 0 #b33c00,
                0 10px 20px rgba(0,0,0,0.4);
        }
        .restart-btn:active {
            transform: translateY(0);
            box-shadow: 0 4px 0 #b33c00;
        }

        /* æŠ€èƒ½ç‰¹æ•ˆå®¹å™¨ */
        .skill-effect-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 18;
            overflow: hidden;
        }

        /* ç‚«é…·æŠ€èƒ½ç‰¹æ•ˆ */
        .skill-effect {
            position: absolute;
            border-radius: 50%;
            animation-duration: 1s;
            animation-fill-mode: forwards;
            z-index: 18;
        }

        /* æ”»å‡»ç‰¹æ•ˆ - åˆ©çˆªçªè¢­ */
        .attack-effect-special {
            background: radial-gradient(circle, rgba(255,100,0,0.8) 0%, rgba(255,50,0,0.4) 70%, transparent 100%);
            width: 150px;
            height: 150px;
            animation: attackExplode 0.8s ease-out;
        }

        /* é­”æ³•ç‰¹æ•ˆ - é­”æ³•é£å¼¹ */
        .magic-effect-special {
            background: radial-gradient(circle, rgba(150,100,255,0.8) 0%, rgba(100,50,255,0.4) 70%, transparent 100%);
            width: 120px;
            height: 120px;
            animation: magicOrbit 1.2s ease-out;
        }

        /* æ²»ç–—ç‰¹æ•ˆ - æ²»æ„ˆèˆ”æ¯› */
        .heal-effect-special {
            background: radial-gradient(circle, rgba(100,255,100,0.8) 0%, rgba(50,200,50,0.4) 70%, transparent 100%);
            width: 180px;
            height: 180px;
            animation: healPulse 1.5s ease-out;
        }

        /* æ§åˆ¶ç‰¹æ•ˆ - å‚¬çœ çˆª */
        .control-effect-special {
            background: radial-gradient(circle, rgba(200,100,255,0.8) 0%, rgba(150,50,200,0.4) 70%, transparent 100%);
            width: 140px;
            height: 140px;
            animation: controlWave 1s ease-out;
        }

        /* ç»ˆææŠ€èƒ½ç‰¹æ•ˆ */
        .ultimate-effect-special {
            background: radial-gradient(circle, rgba(255,50,50,0.8) 0%, rgba(200,0,0,0.4) 70%, transparent 100%);
            width: 300px;
            height: 300px;
            animation: ultimateBlast 1.5s ease-out;
        }

        /* è‡ªæ®‹æŠ€èƒ½ç‰¹æ•ˆ */
        .self-damage-effect-special {
            background: radial-gradient(circle, rgba(100,100,100,0.8) 0%, rgba(50,50,50,0.4) 70%, transparent 100%);
            width: 160px;
            height: 160px;
            animation: selfDamagePulse 1.2s ease-out;
        }

        /* åŠ¨ç”»å…³é”®å¸§ */
        @keyframes attackShake {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(5deg) scale(1.1); }
            50% { transform: rotate(-5deg) scale(1.1); }
            75% { transform: rotate(5deg) scale(1.1); }
            100% { transform: rotate(0deg) scale(1); }
        }
        @keyframes healGlow {
            0% { filter: brightness(1) hue-rotate(0deg); }
            50% { filter: brightness(1.3) hue-rotate(20deg); }
            100% { filter: brightness(1) hue-rotate(0deg); }
        }
        @keyframes controlBlur {
            0% { filter: grayscale(0) blur(0px); }
            50% { filter: grayscale(0.7) blur(3px); }
            100% { filter: grayscale(0) blur(0px); }
        }
        @keyframes tipFloat {
            0% { transform: translateX(-50%) translateY(0px); }
            50% { transform: translateX(-50%) translateY(-10px); }
            100% { transform: translateX(-50%) translateY(0px); }
        }
        @keyframes resultPulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* ç‚«é…·æŠ€èƒ½ç‰¹æ•ˆåŠ¨ç”» */
        @keyframes attackExplode {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.5) rotate(180deg); opacity: 0.8; }
            100% { transform: scale(3) rotate(360deg); opacity: 0; }
        }
        @keyframes magicOrbit {
            0% { transform: translate(0, 0) scale(0); opacity: 1; }
            30% { transform: translate(50px, -30px) scale(1); opacity: 0.9; }
            60% { transform: translate(-50px, 30px) scale(1.2); opacity: 0.7; }
            100% { transform: translate(0, 0) scale(2); opacity: 0; }
        }
        @keyframes healPulse {
            0% { transform: scale(0); opacity: 1; box-shadow: 0 0 0 0 rgba(100,255,100,0.7); }
            70% { transform: scale(1.5); opacity: 0.7; box-shadow: 0 0 0 20px rgba(100,255,100,0); }
            100% { transform: scale(2); opacity: 0; box-shadow: 0 0 0 40px rgba(100,255,100,0); }
        }
        @keyframes controlWave {
            0% { transform: scale(0) rotate(0deg); opacity: 1; filter: blur(0px); }
            50% { transform: scale(1.5) rotate(180deg); opacity: 0.8; filter: blur(5px); }
            100% { transform: scale(3) rotate(360deg); opacity: 0; filter: blur(10px); }
        }
        @keyframes ultimateBlast {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(1); opacity: 0.9; }
            100% { transform: scale(3); opacity: 0; }
        }
        @keyframes selfDamagePulse {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
            100% { transform: scale(2); opacity: 0; }
        }

        /* å® ç‰©çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-indicator {
            position: absolute;
            top: -10px;
            right: -10px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #ff4444;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            z-index: 10;
            box-shadow: 0 0 10px rgba(255, 68, 68, 0.8);
            animation: statusPulse 1s infinite;
        }
        @keyframes statusPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <!-- å® ç‰©é€‰æ‹©ç•Œé¢ -->
    <div class="pet-select-container" id="petSelectContainer">
        <h1 class="select-title">é€‰æ‹©ä½ çš„å® ç‰©</h1>
        <div class="pet-options">
            <!-- å¹´ç³•é€‰é¡¹ -->
            <div class="pet-option" data-pet="niangao">
                <img src="https://s41.ax1x.com/2025/12/09/pZuKotA.png" alt="å¹´ç³•" class="pet-option-img">
                <div class="pet-option-name">å¹´ç³•</div>
                <div class="pet-option-level">ç­‰çº§ï¼š20</div>
                <div class="pet-option-hp">HPï¼š120</div>
                <div class="pet-option-desc">å¼ æ€»çš„ç¥ç§˜å® ç‰©ï¼Œæ€»æ˜¯å–œæ¬¢æŒ‘è¡…ä¸»äººã€‚</div>
                <div class="pet-option-skills">
                    <div class="skill-item">ğŸ’¥ åˆ©çˆªçªè¢­ï¼šå¨åŠ›18ï¼ŒPP12</div>
                    <div class="skill-item">âœ¨ é­”æ³•é£å¼¹ï¼šå¨åŠ›28ï¼ŒPP8</div>
                    <div class="skill-item">â¤ï¸ æ²»æ„ˆèˆ”æ¯›ï¼šæ¢å¤15ï¼ŒPP5</div>
                    <div class="skill-item">ğŸ˜´ å‚¬çœ çˆªï¼šå¨åŠ›10ï¼ŒPP4</div>
                </div>
            </div>
            
            <!-- å°å®é€‰é¡¹ -->
            <div class="pet-option" data-pet="xiaobao">
                <img src="https://s41.ax1x.com/2025/12/09/pZuKv7Q.png" alt="å°å®" class="pet-option-img">
                <div class="pet-option-name">å°å®</div>
                <div class="pet-option-level">ç­‰çº§ï¼š20</div>
                <div class="pet-option-hp">HPï¼š120</div>
                <div class="pet-option-desc">æ–­å°¾æµæµªå°çŒ«ï¼Œæ™ºå•†åœ¨çº¿ + èº«æ‰‹æ•æ·ï¼ŒæŠ—æ‹’è´´è´´å´å¯¹é¸¡èƒ¸è‚‰æ¯«æ— æŠµæŠ—åŠ›ï¼</div>
                <div class="pet-option-skills">
                    <div class="skill-item">ğŸ’¥ åˆ©çˆªçªè¢­ï¼šå¨åŠ›18ï¼ŒPP12</div>
                    <div class="skill-item">âœ¨ é­”æ³•é£å¼¹ï¼šå¨åŠ›28ï¼ŒPP8</div>
                    <div class="skill-item">â¤ï¸ æ²»æ„ˆèˆ”æ¯›ï¼šæ¢å¤15ï¼ŒPP5</div>
                    <div class="skill-item">ğŸ˜´ å‚¬çœ çˆªï¼šå¨åŠ›10ï¼ŒPP4</div>
                </div>
            </div>
            
            <!-- å¼ å„’æ¾é€‰é¡¹ -->
            <div class="pet-option" data-pet="zhangrusong">
                <img src="https://s41.ax1x.com/2025/12/09/pZulj0O.jpg" alt="å¼ å„’æ¾" class="pet-option-img">
                <div class="pet-option-name">å¼ å„’æ¾</div>
                <div class="pet-option-level">ç­‰çº§ï¼š100</div>
                <div class="pet-option-hp">HPï¼š99</div>
                <div class="pet-option-desc">ä¸¤åªå°çŒ«æœ€ä¸¥å‰çš„æ¯äº²---å…¶å®æ˜¯äººå½¢é“²å±å®˜å•¦ï¼</div>
                <div class="pet-option-skills">
                    <div class="skill-item">âœ‹ æ— æƒ…é“æ‰‹ï¼šå¨åŠ›25ï¼ŒPP5</div>
                    <div class="skill-item">ğŸ± å­¦çŒ«å«ï¼šå¨åŠ›10ï¼ŒPP5</div>
                    <div class="skill-item">ğŸš® é“²å±ï¼šå‡å°‘30HPï¼ŒPP5</div>
                    <div class="skill-item">âš¡ å¤©é“ï¼ï¼šå¨åŠ›=å¯¹æ–¹HPï¼ŒPP1</div>
                </div>
            </div>
        </div>
        <button class="start-battle-btn" id="startBattleBtn">å¼€å§‹å¯¹æˆ˜</button>
    </div>

    <!-- å¯¹æˆ˜ç•Œé¢ -->
    <div class="battle-container" id="battleContainer">
        <!-- å® ç‰©å¯¹æˆ˜åŒºåŸŸ -->
        <div class="pet-area">
            <!-- ç©å®¶å® ç‰© -->
            <div class="pet-card player-pet">
                <div class="pet-info">
                    <div class="pet-name" id="playerPetName">å¹´ç³•</div>
                    <div class="pet-level" id="playerPetLevel">ç­‰çº§ï¼š20</div>
                    <div class="hp-container">
                        <span class="hp-label">HP</span>
                        <div class="hp-bar">
                            <div class="hp-fill" id="playerHpFill"></div>
                        </div>
                        <span class="hp-text" id="playerHpText">120/120</span>
                    </div>
                </div>
                <img src="https://s41.ax1x.com/2025/12/09/pZuKotA.png" alt="ç©å®¶å® ç‰©" class="pet-img" id="playerPetImg">
            </div>

            <!-- æ•Œæ–¹å® ç‰© -->
            <div class="pet-card enemy-pet">
                <img src="https://s41.ax1x.com/2025/12/09/pZuKv7Q.png" alt="æ•Œæ–¹å® ç‰©" class="pet-img" id="enemyPetImg">
                <div class="pet-info">
                    <div class="pet-name" id="enemyPetName">å°å®</div>
                    <div class="pet-level" id="enemyPetLevel">ç­‰çº§ï¼š20</div>
                    <div class="hp-container">
                        <span class="hp-label">HP</span>
                        <div class="hp-bar">
                            <div class="hp-fill" id="enemyHpFill"></div>
                        </div>
                        <span class="hp-text" id="enemyHpText">120/120</span>
                    </div>
                </div>
            </div>

            <!-- æŠ€èƒ½ç‰¹æ•ˆå®¹å™¨ -->
            <div class="skill-effect-container" id="skillEffectContainer"></div>

            <!-- å›åˆæç¤º -->
            <div class="round-tip" id="roundTip">ä½ çš„å›åˆï¼é€‰æ‹©æŠ€èƒ½å‡ºå‡»ï½</div>
        </div>

        <!-- æˆ˜æ–—æ—¥å¿—åŒºåŸŸ -->
        <div class="battle-log-wrapper">
            <div class="battle-log" id="battleLog">
                [ç³»ç»Ÿ] æˆ˜æ–—å¼€å§‹ï¼
            </div>
        </div>

        <!-- æŠ€èƒ½æ± åŒºåŸŸ -->
        <div class="skill-pool" id="skillPool">
            <!-- æŠ€èƒ½æŒ‰é’®å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- èƒœè´Ÿæç¤ºå¼¹çª— -->
        <div class="result-modal" id="resultModal">
            <div class="result-text" id="resultText"></div>
            <button class="restart-btn" id="restartBtn">é‡æ–°å¯¹æˆ˜</button>
        </div>
    </div>

    <script>
        // æ‰€æœ‰å® ç‰©æ•°æ®
        const allPets = {
            niangao: {
                name: "å¹´ç³•",
                level: 20,
                maxHp: 120,
                img: "https://s41.ax1x.com/2025/12/09/pZuKotA.png",
                description: "å¼ æ€»çš„ç¥ç§˜å® ç‰©ï¼Œæ€»æ˜¯å–œæ¬¢æŒ‘è¡…ä¸»äººã€‚",
                skills: [
                    { id: "skill1", name: "åˆ©çˆªçªè¢­", icon: "ğŸ’¥", type: "attack", damage: 18, pp: 12 },
                    { id: "skill2", name: "é­”æ³•é£å¼¹", icon: "âœ¨", type: "magic", damage: 28, pp: 8 },
                    { id: "skill3", name: "æ²»æ„ˆèˆ”æ¯›", icon: "â¤ï¸", type: "heal", damage: -15, pp: 5 },
                    { id: "skill4", name: "å‚¬çœ çˆª", icon: "ğŸ˜´", type: "control", damage: 10, pp: 4 }
                ]
            },
            xiaobao: {
                name: "å°å®",
                level: 20,
                maxHp: 120,
                img: "https://s41.ax1x.com/2025/12/09/pZuKv7Q.png",
                description: "æ–­å°¾æµæµªå°çŒ«ï¼Œæ™ºå•†åœ¨çº¿ + èº«æ‰‹æ•æ·ï¼ŒæŠ—æ‹’è´´è´´å´å¯¹é¸¡èƒ¸è‚‰æ¯«æ— æŠµæŠ—åŠ›ï¼",
                skills: [
                    { id: "skill1", name: "åˆ©çˆªçªè¢­", icon: "ğŸ’¥", type: "attack", damage: 18, pp: 12 },
                    { id: "skill2", name: "é­”æ³•é£å¼¹", icon: "âœ¨", type: "magic", damage: 28, pp: 8 },
                    { id: "skill3", name: "æ²»æ„ˆèˆ”æ¯›", icon: "â¤ï¸", type: "heal", damage: -15, pp: 5 },
                    { id: "skill4", name: "å‚¬çœ çˆª", icon: "ğŸ˜´", type: "control", damage: 10, pp: 4 }
                ]
            },
            zhangrusong: {
                name: "å¼ å„’æ¾",
                level: 100,
                maxHp: 99,
                img: "https://s41.ax1x.com/2025/12/09/pZulj0O.jpg",
                description: "ä¸¤åªå°çŒ«æœ€ä¸¥å‰çš„æ¯äº²---å…¶å®æ˜¯äººå½¢é“²å±å®˜å•¦ï¼",
                skills: [
                    { id: "skill1", name: "æ— æƒ…é“æ‰‹", icon: "âœ‹", type: "attack", damage: 25, pp: 5 },
                    { id: "skill2", name: "å­¦çŒ«å«", icon: "ğŸ±", type: "control", damage: 10, pp: 5 },
                    { id: "skill3", name: "é“²å±", icon: "ğŸš®", type: "self-damage", damage: 30, pp: 5 },
                    { id: "skill4", name: "å¤©é“ï¼", icon: "âš¡", type: "ultimate", damage: "enemyHP", pp: 1 }
                ]
            }
        };

        // æ¸¸æˆæ ¸å¿ƒæ•°æ®
        const gameData = {
            playerPetKey: null,
            enemyPetKey: null,
            // ç©å®¶å® ç‰©æ•°æ®
            player: {
                hp: 0,
                maxHp: 0,
                level: 0,
                isStunned: false // æ˜¯å¦è¢«æ§åˆ¶ï¼ˆå‚¬çœ /ææƒ§ï¼‰
            },
            // æ•Œæ–¹å® ç‰©æ•°æ®
            enemy: {
                hp: 0,
                maxHp: 0,
                level: 0,
                isStunned: false
            },
            // æŠ€èƒ½çš„PPæ•°æ®
            skills: {},
            isBattleEnd: false,
            currentRound: 1,
            isEnemyTurn: false // æ ‡è®°æ˜¯å¦ä¸ºæ•Œæ–¹å›åˆï¼Œé˜²æ­¢ç©å®¶ä¸­é€”æ“ä½œ
        };

        // DOMå…ƒç´ è·å–
        const petSelectContainer = document.getElementById('petSelectContainer');
        const battleContainer = document.getElementById('battleContainer');
        const petOptions = document.querySelectorAll('.pet-option');
        const startBattleBtn = document.getElementById('startBattleBtn');
        const playerHpFill = document.getElementById('playerHpFill');
        const playerHpText = document.getElementById('playerHpText');
        const enemyHpFill = document.getElementById('enemyHpFill');
        const enemyHpText = document.getElementById('enemyHpText');
        const battleLog = document.getElementById('battleLog');
        const roundTip = document.getElementById('roundTip');
        const resultModal = document.getElementById('resultModal');
        const resultText = document.getElementById('resultText');
        const restartBtn = document.getElementById('restartBtn');
        const skillPool = document.getElementById('skillPool');
        const playerPetImg = document.getElementById('playerPetImg');
        const playerPetName = document.getElementById('playerPetName');
        const playerPetLevel = document.getElementById('playerPetLevel');
        const enemyPetImg = document.getElementById('enemyPetImg');
        const enemyPetName = document.getElementById('enemyPetName');
        const enemyPetLevel = document.getElementById('enemyPetLevel');
        const skillEffectContainer = document.getElementById('skillEffectContainer');

        // å® ç‰©é€‰æ‹©é€»è¾‘
        let selectedPet = null;

        // å® ç‰©é€‰é¡¹ç‚¹å‡»äº‹ä»¶
        petOptions.forEach(option => {
            option.addEventListener('click', () => {
                // ç§»é™¤å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
                petOptions.forEach(opt => opt.classList.remove('selected'));
                // æ·»åŠ å½“å‰é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
                option.classList.add('selected');
                // è®°å½•é€‰ä¸­çš„å® ç‰©
                selectedPet = option.dataset.pet;
            });
        });

        // å¼€å§‹æˆ˜æ–—æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        startBattleBtn.addEventListener('click', () => {
            if (!selectedPet) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€åªå® ç‰©ï¼');
                return;
            }

            // ç¡®å®šç©å®¶å’Œæ•Œæ–¹å® ç‰©
            gameData.playerPetKey = selectedPet;
            
            // ä»å‰©ä½™å® ç‰©ä¸­éšæœºé€‰æ‹©æ•Œæ–¹å® ç‰©
            const availablePets = Object.keys(allPets).filter(key => key !== selectedPet);
            gameData.enemyPetKey = availablePets[Math.floor(Math.random() * availablePets.length)];

            // éšè—é€‰æ‹©ç•Œé¢ï¼Œæ˜¾ç¤ºæˆ˜æ–—ç•Œé¢
            petSelectContainer.style.display = 'none';
            battleContainer.style.display = 'block';

            // åˆå§‹åŒ–æˆ˜æ–—
            initBattle();
        });

        // åˆå§‹åŒ–æˆ˜æ–—
        function initBattle() {
            const playerPet = allPets[gameData.playerPetKey];
            const enemyPet = allPets[gameData.enemyPetKey];

            // åˆå§‹åŒ–ç©å®¶æ•°æ®
            gameData.player.hp = playerPet.maxHp;
            gameData.player.maxHp = playerPet.maxHp;
            gameData.player.level = playerPet.level;
            gameData.player.isStunned = false;

            // åˆå§‹åŒ–æ•Œæ–¹æ•°æ®
            gameData.enemy.hp = enemyPet.maxHp;
            gameData.enemy.maxHp = enemyPet.maxHp;
            gameData.enemy.level = enemyPet.level;
            gameData.enemy.isStunned = false;

            // åˆå§‹åŒ–æŠ€èƒ½æ•°æ®
            gameData.skills = {};
            playerPet.skills.forEach(skill => {
                gameData.skills[skill.id] = {
                    pp: skill.pp,
                    maxPp: skill.pp,
                    type: skill.type,
                    damage: skill.damage
                };
            });

            // é‡ç½®æˆ˜æ–—çŠ¶æ€
            gameData.isBattleEnd = false;
            gameData.currentRound = 1;
            gameData.isEnemyTurn = false;

            // æ›´æ–°UIæ˜¾ç¤º
            updatePetDisplay();
            createSkillButtons(playerPet.skills);
            updateHpDisplay();
            clearLog();
            addLog(`[ç³»ç»Ÿ] æˆ˜æ–—å¼€å§‹ï¼${playerPet.name} vs ${enemyPet.name}`);
            
            // æ˜¾ç¤ºå›åˆæç¤º
            resultModal.style.display = 'none';
            showRoundTip('ä½ çš„å›åˆï¼é€‰æ‹©æŠ€èƒ½å‡ºå‡»ï½');
        }

        // æ›´æ–°å® ç‰©æ˜¾ç¤º
        function updatePetDisplay() {
            const playerPet = allPets[gameData.playerPetKey];
            const enemyPet = allPets[gameData.enemyPetKey];

            // æ›´æ–°ç©å®¶å® ç‰©
            playerPetImg.src = playerPet.img;
            playerPetImg.alt = playerPet.name;
            playerPetName.textContent = playerPet.name;
            playerPetLevel.textContent = `ç­‰çº§ï¼š${playerPet.level}`;

            // æ›´æ–°æ•Œæ–¹å® ç‰©
            enemyPetImg.src = enemyPet.img;
            enemyPetImg.alt = enemyPet.name;
            enemyPetName.textContent = enemyPet.name;
            enemyPetLevel.textContent = `ç­‰çº§ï¼š${enemyPet.level}`;
        }

        // åˆ›å»ºæŠ€èƒ½æŒ‰é’®
        function createSkillButtons(skills) {
            // æ¸…ç©ºæŠ€èƒ½æ± 
            skillPool.innerHTML = '';

            // åˆ›å»ºæŠ€èƒ½æŒ‰é’®
            skills.forEach(skill => {
                const btn = document.createElement('button');
                btn.className = `skill-btn`;
                btn.id = skill.id;
                btn.dataset.type = skill.type;
                btn.dataset.damage = skill.damage;
                btn.dataset.pp = skill.pp;
                
                btn.innerHTML = `
                    <div class="skill-icon">${skill.icon}</div>
                    <div class="skill-name">${skill.name}</div>
                    <div class="skill-details">
                        <span class="skill-pp">PP: <span class="pp-count">${skill.pp}</span></span>
                        <span class="skill-power">${skill.damage === 'enemyHP' ? 'ç§’æ€' : skill.damage > 0 ? 'å¨åŠ›: ' + skill.damage : 'æ¢å¤: ' + (-skill.damage)}</span>
                    </div>
                `;
                
                btn.addEventListener('click', () => playerUseSkill(btn));
                skillPool.appendChild(btn);
            });
        }

        // æ›´æ–°HPæ˜¾ç¤º
        function updateHpDisplay() {
            // ç©å®¶HP
            const playerHpPercent = (gameData.player.hp / gameData.player.maxHp) * 100;
            playerHpFill.style.width = `${playerHpPercent}%`;
            playerHpText.textContent = `${gameData.player.hp}/${gameData.player.maxHp}`;

            // æ•Œæ–¹HP
            const enemyHpPercent = (gameData.enemy.hp / gameData.enemy.maxHp) * 100;
            enemyHpFill.style.width = `${enemyHpPercent}%`;
            enemyHpText.textContent = `${gameData.enemy.hp}/${gameData.enemy.maxHp}`;
        }

        // æ›´æ–°æŠ€èƒ½PPæ˜¾ç¤º
        function updateSkillDisplay() {
            const skillButtons = document.querySelectorAll('.skill-btn');
            skillButtons.forEach(btn => {
                const skillId = btn.id;
                const pp = gameData.skills[skillId].pp;
                // æ›´æ–°PPæ•°å€¼
                btn.querySelector('.pp-count').textContent = pp;
                // ç¦ç”¨æ¡ä»¶ï¼šPPä¸º0 / æˆ˜æ–—ç»“æŸ / ç©å®¶è¢«æ§åˆ¶ / æ•Œæ–¹å›åˆä¸­
                const isDisabled = pp <= 0 || gameData.isBattleEnd || gameData.player.isStunned || gameData.isEnemyTurn;
                btn.disabled = isDisabled;
            });
        }

        // æ·»åŠ å¯¹æˆ˜æ—¥å¿—
        function addLog(text) {
            const time = new Date().toLocaleTimeString();
            battleLog.innerHTML += `<br>[${time}] ${text}`;
            // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
            battleLog.scrollTop = battleLog.scrollHeight;
        }

        // æ¸…ç©ºæ—¥å¿—
        function clearLog() {
            battleLog.innerHTML = '[ç³»ç»Ÿ] æˆ˜æ–—å¼€å§‹ï¼';
        }

        // æ˜¾ç¤ºå›åˆæç¤º
        function showRoundTip(text) {
            roundTip.textContent = text;
            roundTip.style.display = 'block';
            // 3ç§’åéšè—
            setTimeout(() => {
                if (!gameData.isBattleEnd) {
                    roundTip.style.display = 'none';
                }
            }, 3000);
        }

        // æ’­æ”¾ç‚«é…·æŠ€èƒ½ç‰¹æ•ˆ
        function playSkillEffect(isPlayer, skillType) {
            const targetImg = isPlayer ? enemyPetImg : playerPetImg;
            const targetRect = targetImg.getBoundingClientRect();
            const containerRect = document.querySelector('.battle-container').getBoundingClientRect();
            
            // è®¡ç®—ç‰¹æ•ˆä½ç½®ï¼ˆåœ¨ç›®æ ‡å® ç‰©ä¸­å¿ƒï¼‰
            const effectX = targetRect.left - containerRect.left + targetRect.width/2;
            const effectY = targetRect.top - containerRect.top + targetRect.height/2;
            
            // åˆ›å»ºç‰¹æ•ˆå…ƒç´ 
            const effectEl = document.createElement('div');
            effectEl.className = 'skill-effect';
            
            // æ ¹æ®æŠ€èƒ½ç±»å‹æ·»åŠ ä¸åŒç‰¹æ•ˆ
            switch (skillType) {
                case 'attack':
                    effectEl.classList.add('attack-effect-special');
                    addLog(`ğŸ’¥ æ”»å‡»å‘½ä¸­ï¼`);
                    break;
                case 'magic':
                    effectEl.classList.add('magic-effect-special');
                    addLog(`âœ¨ é­”æ³•ç”Ÿæ•ˆï¼`);
                    break;
                case 'heal':
                    effectEl.classList.add('heal-effect-special');
                    addLog(`â¤ï¸ æ²»ç–—ç”Ÿæ•ˆï¼`);
                    break;
                case 'control':
                    effectEl.classList.add('control-effect-special');
                    addLog(`ğŸ˜´ æ§åˆ¶ç”Ÿæ•ˆï¼`);
                    break;
                case 'self-damage':
                    effectEl.classList.add('self-damage-effect-special');
                    addLog(`ğŸ’” è‡ªæ®‹æ•ˆæœï¼`);
                    break;
                case 'ultimate':
                    effectEl.classList.add('ultimate-effect-special');
                    addLog(`âš¡ ç»ˆææŠ€èƒ½ï¼`);
                    break;
            }
            
            // è®¾ç½®ç‰¹æ•ˆä½ç½®
            effectEl.style.left = `${effectX}px`;
            effectEl.style.top = `${effectY}px`;
            effectEl.style.transform = 'translate(-50%, -50%)';
            
            // æ·»åŠ åˆ°å®¹å™¨
            skillEffectContainer.appendChild(effectEl);
            
            // æ’­æ”¾å® ç‰©ç‰¹æ•ˆåŠ¨ç”»
            let petEffectType, petImg;
            
            if (skillType === 'heal') {
                petEffectType = 'heal';
                petImg = isPlayer ? playerPetImg : enemyPetImg;
            } else if (skillType === 'control') {
                petEffectType = 'control';
                petImg = targetImg;
            } else if (skillType === 'self-damage') {
                petEffectType = 'attack';
                petImg = isPlayer ? playerPetImg : enemyPetImg;
            } else {
                petEffectType = 'attack';
                petImg = targetImg;
            }
            
            if (petEffectType === 'control') {
                petImg.classList.add('control-effect');
            } else if (petEffectType === 'heal') {
                petImg.classList.add('heal-effect');
            } else {
                petImg.classList.add('attack-effect');
            }
            
            // ç§»é™¤ç‰¹æ•ˆå…ƒç´ å’Œå® ç‰©ç‰¹æ•ˆç±»å
            setTimeout(() => {
                effectEl.remove();
                petImg.classList.remove('attack-effect', 'heal-effect', 'control-effect');
            }, 1500);
        }

        // ç©å®¶é‡Šæ”¾æŠ€èƒ½
        function playerUseSkill(skillBtn) {
            // é˜²æ­¢æˆ˜æ–—ç»“æŸ/æ•Œæ–¹å›åˆ/ç©å®¶è¢«æ§åˆ¶æ—¶æ“ä½œ
            if (gameData.isBattleEnd || gameData.isEnemyTurn || gameData.player.isStunned) {
                addLog(`[æç¤º] æ— æ³•é‡Šæ”¾æŠ€èƒ½ï¼${gameData.player.isStunned ? 'ä½ è¢«æ§åˆ¶äº†' : 'å½“å‰æ˜¯æ•Œæ–¹å›åˆ'}`);
                return;
            }

            const skillId = skillBtn.id;
            const skill = gameData.skills[skillId];
            
            // æ£€æŸ¥PPæ˜¯å¦è¶³å¤Ÿ
            if (skill.pp <= 0) {
                addLog(`[æç¤º] ${skillBtn.querySelector('.skill-name').textContent}çš„PPå·²è€—å°½ï¼`);
                return;
            }

            const damage = skillBtn.dataset.damage;
            const skillType = skillBtn.dataset.type;
            const skillName = skillBtn.querySelector('.skill-name').textContent;

            // æ ‡è®°ä¸ºæ•Œæ–¹å›åˆï¼Œé˜²æ­¢ç©å®¶é‡å¤æ“ä½œ
            gameData.isEnemyTurn = true;
            // ä¸´æ—¶ç¦ç”¨æ‰€æœ‰æŠ€èƒ½æŒ‰é’®ï¼ˆæ•Œæ–¹å›åˆä¸­ï¼‰
            document.querySelectorAll('.skill-btn').forEach(btn => btn.disabled = true);

            // æ‰£PP
            skill.pp -= 1;
            updateSkillDisplay();

            // æ’­æ”¾æŠ€èƒ½ç‰¹æ•ˆ
            playSkillEffect(true, skillType);

            // æ‰§è¡ŒæŠ€èƒ½æ•ˆæœ
            const playerPet = allPets[gameData.playerPetKey];
            switch (skillType) {
                case 'attack': // ç‰©ç†æ”»å‡»
                    gameData.enemy.hp = Math.max(0, gameData.enemy.hp - parseInt(damage));
                    addLog(`[ä½ çš„å›åˆ] ${playerPet.name}ä½¿ç”¨äº†${skillName}ï¼Œé€ æˆ${damage}ç‚¹ç‰©ç†ä¼¤å®³ï¼`);
                    break;
                case 'magic': // é­”æ³•æ”»å‡»
                    gameData.enemy.hp = Math.max(0, gameData.enemy.hp - parseInt(damage));
                    addLog(`[ä½ çš„å›åˆ] ${playerPet.name}ä½¿ç”¨äº†${skillName}ï¼Œé€ æˆ${damage}ç‚¹é­”æ³•ä¼¤å®³ï¼`);
                    break;
                case 'heal': // å›è¡€
                    gameData.player.hp = Math.min(gameData.player.maxHp, gameData.player.hp + parseInt(-damage));
                    addLog(`[ä½ çš„å›åˆ] ${playerPet.name}ä½¿ç”¨äº†${skillName}ï¼Œæ¢å¤äº†${-damage}ç‚¹HPï¼`);
                    break;
                case 'control': // æ§åˆ¶ï¼ˆå‚¬çœ /ææƒ§ï¼‰
                    gameData.enemy.isStunned = true;
                    gameData.enemy.hp = Math.max(0, gameData.enemy.hp - parseInt(damage));
                    addLog(`[ä½ çš„å›åˆ] ${playerPet.name}ä½¿ç”¨äº†${skillName}ï¼Œé€ æˆ${damage}ç‚¹ä¼¤å®³å¹¶ä½¿å¯¹æ‰‹é™·å…¥ææƒ§ï¼`);
                    break;
                case 'self-damage': // è‡ªæ®‹
                    gameData.player.hp = Math.max(0, gameData.player.hp - parseInt(damage));
                    addLog(`[ä½ çš„å›åˆ] ${playerPet.name}ä½¿ç”¨äº†${skillName}ï¼Œå‡å°‘äº†${damage}ç‚¹HPï¼`);
                    break;
                case 'ultimate': // ç»ˆææŠ€èƒ½
                    const ultimateDamage = gameData.enemy.hp; // ä¼¤å®³ç­‰äºå¯¹æ–¹å½“å‰HP
                    gameData.enemy.hp = 0;
                    addLog(`[ä½ çš„å›åˆ] ${playerPet.name}ä½¿ç”¨äº†${skillName}ï¼Œé€ æˆ${ultimateDamage}ç‚¹ç§’æ€ä¼¤å®³ï¼`);
                    break;
            }

            // æ›´æ–°HP
            updateHpDisplay();

            // æ£€æŸ¥æ•Œæ–¹æ˜¯å¦æˆ˜è´¥
            if (gameData.enemy.hp <= 0) {
                endBattle(true);
                gameData.isEnemyTurn = false; // é‡ç½®å›åˆæ ‡è®°
                return;
            }

            // æ£€æŸ¥ç©å®¶æ˜¯å¦è‡ªæ®‹è‡´æ­»
            if (gameData.player.hp <= 0) {
                endBattle(false);
                gameData.isEnemyTurn = false;
                return;
            }

            // æ•Œæ–¹å›åˆï¼ˆå»¶è¿Ÿ1.5ç§’ï¼Œæ¨¡æ‹Ÿæ€è€ƒï¼‰
            setTimeout(enemyTurn, 1500);
        }

        // æ•Œæ–¹å›åˆ
        function enemyTurn() {
            if (gameData.isBattleEnd) {
                gameData.isEnemyTurn = false;
                updateSkillDisplay(); // è§£é”æŠ€èƒ½æŒ‰é’®
                return;
            }

            showRoundTip('å¯¹æ‰‹çš„å›åˆï¼å‡†å¤‡å‡ºæ‹›ï½');

            // å¦‚æœè¢«å‚¬çœ /ææƒ§ï¼Œè·³è¿‡å›åˆ
            if (gameData.enemy.isStunned) {
                addLog(`[æ•Œæ–¹å›åˆ] ${allPets[gameData.enemyPetKey].name}è¢«æ§åˆ¶äº†ï¼Œæ— æ³•è¡ŒåŠ¨ï¼`);
                gameData.enemy.isStunned = false; // è§£é™¤æ§åˆ¶
                
                // å›åˆç»“æŸï¼Œè½®åˆ°ç©å®¶
                gameData.currentRound++;
                gameData.isEnemyTurn = false;
                updateSkillDisplay(); // è§£é”æŠ€èƒ½æŒ‰é’®
                showRoundTip('ä½ çš„å›åˆï¼é€‰æ‹©æŠ€èƒ½å‡ºå‡»ï½');
                return;
            }

            // æ•Œæ–¹é€‰æ‹©æŠ€èƒ½ï¼ˆç®€å•AIï¼‰
            const enemyPet = allPets[gameData.enemyPetKey];
            const availableSkills = enemyPet.skills.filter(skill => {
                // ç®€å•é€»è¾‘ï¼šé€‰æ‹©è¿˜æœ‰PPçš„æŠ€èƒ½
                return gameData.skills[skill.id] ? gameData.skills[skill.id].pp > 0 : true;
            });

            // å¦‚æœæ²¡æœ‰å¯ç”¨æŠ€èƒ½ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªï¼ˆè™½ç„¶PPä¸º0ï¼Œä½†å¼ºè¡Œä½¿ç”¨ï¼‰
            const selectedSkill = availableSkills.length > 0 
                ? availableSkills[Math.floor(Math.random() * availableSkills.length)]
                : enemyPet.skills[Math.floor(Math.random() * enemyPet.skills.length)];

            // æ‰£PPï¼ˆå¦‚æœè¿˜æœ‰çš„è¯ï¼‰
            if (gameData.skills[selectedSkill.id]) {
                gameData.skills[selectedSkill.id].pp = Math.max(0, gameData.skills[selectedSkill.id].pp - 1);
            }

            // æ’­æ”¾æŠ€èƒ½ç‰¹æ•ˆ
            playSkillEffect(false, selectedSkill.type);

            // æ‰§è¡ŒæŠ€èƒ½æ•ˆæœ
            switch (selectedSkill.type) {
                case 'attack': // ç‰©ç†æ”»å‡»
                    gameData.player.hp = Math.max(0, gameData.player.hp - selectedSkill.damage);
                    addLog(`[æ•Œæ–¹å›åˆ] ${enemyPet.name}ä½¿ç”¨äº†${selectedSkill.name}ï¼Œé€ æˆ${selectedSkill.damage}ç‚¹ç‰©ç†ä¼¤å®³ï¼`);
                    break;
                case 'magic': // é­”æ³•æ”»å‡»
                    gameData.player.hp = Math.max(0, gameData.player.hp - selectedSkill.damage);
                    addLog(`[æ•Œæ–¹å›åˆ] ${enemyPet.name}ä½¿ç”¨äº†${selectedSkill.name}ï¼Œé€ æˆ${selectedSkill.damage}ç‚¹é­”æ³•ä¼¤å®³ï¼`);
                    break;
                case 'heal': // å›è¡€
                    gameData.enemy.hp = Math.min(gameData.enemy.maxHp, gameData.enemy.hp - selectedSkill.damage);
                    addLog(`[æ•Œæ–¹å›åˆ] ${enemyPet.name}ä½¿ç”¨äº†${selectedSkill.name}ï¼Œæ¢å¤äº†${-selectedSkill.damage}ç‚¹HPï¼`);
                    break;
                case 'control': // æ§åˆ¶ï¼ˆå‚¬çœ /ææƒ§ï¼‰
                    gameData.player.isStunned = true;
                    gameData.player.hp = Math.max(0, gameData.player.hp - selectedSkill.damage);
                    addLog(`[æ•Œæ–¹å›åˆ] ${enemyPet.name}ä½¿ç”¨äº†${selectedSkill.name}ï¼Œé€ æˆ${selectedSkill.damage}ç‚¹ä¼¤å®³å¹¶ä½¿ä½ é™·å…¥ææƒ§ï¼`);
                    break;
                case 'self-damage': // è‡ªæ®‹
                    gameData.enemy.hp = Math.max(0, gameData.enemy.hp - selectedSkill.damage);
                    addLog(`[æ•Œæ–¹å›åˆ] ${enemyPet.name}ä½¿ç”¨äº†${selectedSkill.name}ï¼Œå‡å°‘äº†${selectedSkill.damage}ç‚¹HPï¼`);
                    break;
                case 'ultimate': // ç»ˆææŠ€èƒ½
                    const ultimateDamage = gameData.player.hp; // ä¼¤å®³ç­‰äºå¯¹æ–¹å½“å‰HP
                    gameData.player.hp = 0;
                    addLog(`[æ•Œæ–¹å›åˆ] ${enemyPet.name}ä½¿ç”¨äº†${selectedSkill.name}ï¼Œé€ æˆ${ultimateDamage}ç‚¹ç§’æ€ä¼¤å®³ï¼`);
                    break;
            }

            // æ›´æ–°HP
            updateHpDisplay();

            // æ£€æŸ¥ç©å®¶æ˜¯å¦æˆ˜è´¥
            if (gameData.player.hp <= 0) {
                endBattle(false);
                gameData.isEnemyTurn = false;
                return;
            }

            // æ£€æŸ¥æ•Œæ–¹æ˜¯å¦è‡ªæ®‹è‡´æ­»
            if (gameData.enemy.hp <= 0) {
                endBattle(true);
                gameData.isEnemyTurn = false;
                return;
            }

            // å›åˆç»“æŸï¼Œè½®åˆ°ç©å®¶
            gameData.currentRound++;
            gameData.isEnemyTurn = false;
            updateSkillDisplay(); // è§£é”æŠ€èƒ½æŒ‰é’®
            showRoundTip('ä½ çš„å›åˆï¼é€‰æ‹©æŠ€èƒ½å‡ºå‡»ï½');
        }

        // ç»“æŸæˆ˜æ–—
        function endBattle(isPlayerWin) {
            gameData.isBattleEnd = true;
            resultModal.style.display = 'flex';
            
            if (isPlayerWin) {
                resultText.textContent = `èƒœåˆ©ï¼${allPets[gameData.playerPetKey].name}å‡»è´¥äº†å¯¹æ‰‹ï¼`;
                addLog(`[ç³»ç»Ÿ] æˆ˜æ–—ç»“æŸï¼ä½ èƒœåˆ©äº†ï¼`);
            } else {
                resultText.textContent = `å¤±è´¥ï¼${allPets[gameData.enemyPetKey].name}è·å¾—äº†èƒœåˆ©ï¼`;
                addLog(`[ç³»ç»Ÿ] æˆ˜æ–—ç»“æŸï¼ä½ å¤±è´¥äº†ï¼`);
            }
            
            roundTip.style.display = 'none';
        }

        // é‡æ–°å¼€å§‹æˆ˜æ–—
        restartBtn.addEventListener('click', () => {
            // éšè—æˆ˜æ–—ç•Œé¢ï¼Œæ˜¾ç¤ºé€‰æ‹©ç•Œé¢
            battleContainer.style.display = 'none';
            petSelectContainer.style.display = 'flex';
            // é‡ç½®é€‰æ‹©çŠ¶æ€
            petOptions.forEach(opt => opt.classList.remove('selected'));
            selectedPet = null;
        });

        // åˆå§‹æ˜¾ç¤ºå® ç‰©é€‰æ‹©ç•Œé¢
        petSelectContainer.style.display = 'flex';
    </script>
</body>
</html>