<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ´›å…‹ç‹å›½é£æ ¼ - å¹´ç³• vs å°å® PKå¯¹æˆ˜</title>
    <style>
        /* å…¨å±€æ ·å¼ - ä»¿æ´›å…‹ç‹å›½å¤å¤ç«¥è¯é£æ ¼ */
        * {
            margin: 0;
            padding: 0;
            font-family: "Microsoft YaHei", "å¹¼åœ†", "Comic Sans MS", serif;
            box-sizing: border-box;
        }
        body {
            background: #f0f8ff; /* é¡µé¢èƒŒæ™¯æµ…è“ï¼Œçªå‡ºæ¸¸æˆæ¡† */
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px 0;
        }

        /* å¯¹æˆ˜ä¸»å®¹å™¨ - å¸¦æœ¨çº¹è¾¹æ¡†+å†…å‘å…‰ï¼ˆèƒŒæ™¯å›¾ç§»è‡³æ­¤å¤„ï¼‰ */
        .battle-container {
            width: 1100px;
            height: 720px;
            background: url("https://ts4.tc.mm.bing.net/th/id/OIP-C.QnH_ONh4t19UJ5GuYK1ODAHaEU?rs=1&pid=ImgDetMain&o=7&rm=3") no-repeat center center;
            background-size: cover;
            border: 10px solid #d4b16a;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(212, 177, 106, 0.8), inset 0 0 20px rgba(0,0,0,0.2);
        }

        /* å® ç‰©ç«™ä½åŒºåŸŸ - åŠé€æ˜é®ç½©ï¼Œä¸é®æŒ¡èƒŒæ™¯å›¾ */
        .pet-area {
            width: 100%;
            height: 420px;
            display: flex;
            justify-content: space-between;
            padding: 30px;
            position: relative;
            background: rgba(255, 255, 255, 0.15); /* åŠé€æ˜é®ç½©ï¼Œä¿ç•™èƒŒæ™¯å›¾å¯è§ */
        }

        /* å® ç‰©å¡ç‰‡ - è°ƒæ•´å¸ƒå±€ï¼Œé¿å…é®æŒ¡è¡€æ¡ */
        .pet-card {
            width: 380px; /* åŠ å®½å¡ç‰‡ */
            height: 380px;
            position: relative;
            filter: drop-shadow(0 0 15px rgba(0,0,0,0.2));
            display: flex;
            flex-direction: column;
        }
        .player-pet {
            align-items: flex-start;
            justify-content: flex-end;
        }
        .enemy-pet {
            align-items: flex-end;
            justify-content: flex-start;
        }

        /* å® ç‰©å½¢è±¡ - è°ƒæ•´ä½ç½®ï¼Œå®Œå…¨é¿å¼€è¡€æ¡é¢æ¿ */
        .pet-img {
            width: 240px;
            height: 240px;
            border-radius: 50%;
            border: 8px solid #fff;
            box-shadow: 
                0 0 0 4px #ffd700,
                0 0 20px rgba(255, 215, 0, 0.6),
                0 0 40px rgba(255, 215, 0, 0.3);
            background: linear-gradient(45deg, #f8f8f8, #e8e8e8);
            object-fit: cover;
            transition: all 0.3s ease;
            position: relative;
            z-index: 5;
        }
        .player-pet .pet-img {
            margin-top: 10px; /* ä¸‹ç§»å›¾ç‰‡ï¼Œé¿å¼€ä¸Šæ–¹è¡€æ¡ */
        }
        .enemy-pet .pet-img {
            margin-bottom: 10px; /* ä¸Šç§»å›¾ç‰‡ï¼Œé¿å¼€ä¸‹æ–¹è¡€æ¡ */
        }
        /* å® ç‰©å—å‡»/å›è¡€ç‰¹æ•ˆ */
        .pet-img.attack-effect {
            animation: attackShake 0.5s ease;
        }
        .pet-img.heal-effect {
            animation: healGlow 0.8s ease;
        }
        .pet-img.control-effect {
            animation: controlBlur 1s ease;
        }

        /* å® ç‰©ä¿¡æ¯é¢æ¿ - è°ƒæ•´å±‚çº§å’Œä½ç½®ï¼Œç¡®ä¿ä¸è¢«é®æŒ¡ */
        .pet-info {
            width: 320px;
            height: 90px;
            background: linear-gradient(135deg, rgba(30, 30, 60, 0.85) 0%, rgba(10, 10, 40, 0.85) 100%);
            border-radius: 15px;
            padding: 12px 15px;
            color: #fff;
            position: relative;
            box-shadow: 0 8px 0 rgba(0,0,0,0.2), inset 0 2px 0 rgba(255,255,255,0.1);
            border: 2px solid #ffd700;
            z-index: 6; /* æé«˜å±‚çº§ï¼Œç¡®ä¿åœ¨å›¾ç‰‡ä¸Šæ–¹ */
            margin-bottom: 15px; /* ç©å®¶è¡€æ¡ä¸å›¾ç‰‡é—´è· */
        }
        .enemy-pet .pet-info {
            margin-top: 15px; /* æ•Œæ–¹è¡€æ¡ä¸å›¾ç‰‡é—´è· */
        }
        .pet-name {
            font-size: 22px;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 6px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .pet-level {
            font-size: 16px;
            color: #99ccff;
            margin-bottom: 8px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        /* HPè¡€æ¡å®¹å™¨ */
        .hp-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .hp-label {
            font-size: 16px;
            color: #ff6666;
            font-weight: bold;
        }
        .hp-bar {
            flex: 1;
            height: 18px;
            background: linear-gradient(135deg, #222 0%, #333 100%);
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #666;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }
        .hp-fill {
            height: 100%;
            background: linear-gradient(135deg, #ff6666 0%, #ff4444 50%, #ff2222 100%);
            border-radius: 6px;
            transition: width 0.5s ease;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.3);
        }
        .hp-text {
            font-size: 14px;
            color: #fff;
            min-width: 70px;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(255,255,255,0.5);
        }

        /* æˆ˜æ–—æ—¥å¿—åŒºåŸŸ - ç§»è‡³å® ç‰©åŒºä¸‹æ–¹ã€æŠ€èƒ½æ± ä¸Šæ–¹ */
        .battle-log-wrapper {
            width: 100%;
            height: 110px;
            padding: 0 20px;
            background: rgba(155, 123, 72, 0.4); /* åŠé€æ˜æœ¨çº¹é®ç½© */
            border-top: 2px solid #d4b16a;
            border-bottom: 2px solid #d4b16a;
        }
        .battle-log {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0,0,0,0.7) 0%, rgba(20,20,40,0.7) 100%);
            border-radius: 15px;
            padding: 12px 15px;
            color: #fff;
            font-size: 15px;
            overflow-y: auto;
            z-index: 10;
            border: 2px solid #ffd700;
            box-shadow: 0 8px 15px rgba(0,0,0,0.3);
        }
        /* æ—¥å¿—æ»šåŠ¨æ¡ç¾åŒ– */
        .battle-log::-webkit-scrollbar {
            width: 8px;
        }
        .battle-log::-webkit-scrollbar-track {
            background: #333;
            border-radius: 4px;
        }
        .battle-log::-webkit-scrollbar-thumb {
            background: #ffd700;
            border-radius: 4px;
        }

        /* æŠ€èƒ½æ± åŒºåŸŸ - æ´›å…‹ç‹å›½ç»å…¸æœ¨çº¹+é‡‘è‰²é•¶è¾¹ */
        .skill-pool {
            width: 100%;
            height: 230px;
            background: linear-gradient(180deg, #9b7b48 0%, #8b6914 50%, #7a5a00 100%);
            border-top: 8px solid #d4b16a;
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            box-shadow: inset 0 4px 10px rgba(0,0,0,0.3);
            position: relative;
            z-index: 8;
        }

        /* æŠ€èƒ½æŒ‰é’® - é­”æ³•æ°´æ™¶æŒ‰é’®é£æ ¼ï¼ˆè¶…ç²¾ç¾ï¼‰ */
        .skill-btn {
            background: linear-gradient(135deg, #4a90e2 0%, #2962ff 50%, #1a4999 100%);
            border: none;
            border-radius: 15px;
            padding: 15px 10px;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 6px 0 #1a4999,
                0 8px 15px rgba(0,0,0,0.3),
                inset 0 2px 0 rgba(255,255,255,0.3);
            position: relative;
            overflow: hidden;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        /* æŠ€èƒ½æŒ‰é’®çº¹ç† */
        .skill-btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 50%);
            pointer-events: none;
        }
        .skill-btn::after {
            content: "PP: ";
            position: absolute;
            bottom: 8px;
            right: 12px;
            font-size: 14px;
            color: #ffff99;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        .skill-btn:disabled {
            background: linear-gradient(135deg, #888 0%, #666 50%, #444 100%);
            cursor: not-allowed;
            box-shadow: 0 6px 0 #444, 0 8px 15px rgba(0,0,0,0.3);
            opacity: 0.7;
            transform: translateY(2px);
        }
        .skill-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #6aa8ff 0%, #4a90e2 50%, #2962ff 100%);
            transform: translateY(-3px);
            box-shadow: 
                0 8px 0 #1a4999,
                0 12px 20px rgba(0,0,0,0.4),
                0 0 20px rgba(74, 144, 226, 0.5);
        }
        .skill-btn:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 
                0 4px 0 #1a4999,
                0 6px 10px rgba(0,0,0,0.3);
        }
        /* æŠ€èƒ½PPæ•°å€¼ */
        .skill-pp {
            position: absolute;
            bottom: 8px;
            right: 40px;
            font-size: 14px;
            color: #ffff99;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        /* å›åˆæç¤º - æ‚¬æµ®æ°”æ³¡+å‘å…‰ç‰¹æ•ˆ */
        .round-tip {
            position: absolute;
            top: 180px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 25px;
            background: linear-gradient(135deg, #ffd700 0%, #ffc107 100%);
            color: #8b4513;
            font-weight: bold;
            font-size: 18px;
            border-radius: 30px;
            display: none;
            z-index: 15;
            box-shadow: 
                0 4px 15px rgba(255, 215, 0, 0.6),
                0 0 20px rgba(255, 215, 0, 0.4);
            text-shadow: 0 1px 2px rgba(255,255,255,0.5);
            border: 2px solid #fff;
            animation: tipFloat 2s ease-in-out infinite;
        }

        /* èƒœåˆ©/å¤±è´¥æç¤ºå¼¹çª— - é­”æ³•å¼¹çª—é£æ ¼ */
        .result-modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 450px;
            height: 220px;
            background: linear-gradient(135deg, rgba(0,0,0,0.9) 0%, rgba(30,30,60,0.9) 100%);
            border: 8px solid #ffd700;
            border-radius: 25px;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #fff;
            z-index: 20;
            box-shadow: 
                0 0 50px rgba(255, 215, 0, 0.8),
                inset 0 0 30px rgba(255, 215, 0, 0.3);
        }
        .result-text {
            font-size: 32px;
            margin-bottom: 25px;
            color: #ff6600;
            font-weight: bold;
            text-shadow: 0 2px 10px rgba(255, 102, 0, 0.8);
            animation: resultPulse 1.5s ease-in-out infinite;
        }
        .restart-btn {
            padding: 12px 40px;
            background: linear-gradient(135deg, #ff6600 0%, #ff4500 50%, #e03e00 100%);
            border: none;
            border-radius: 15px;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 
                0 6px 0 #b33c00,
                0 8px 15px rgba(0,0,0,0.3);
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }
        .restart-btn:hover {
            background: linear-gradient(135deg, #ff8800 0%, #ff6600 50%, #ff4500 100%);
            transform: translateY(-3px);
            box-shadow: 
                0 8px 0 #b33c00,
                0 10px 20px rgba(0,0,0,0.4);
        }
        .restart-btn:active {
            transform: translateY(0);
            box-shadow: 0 4px 0 #b33c00;
        }

        /* æŠ€èƒ½ç‰¹æ•ˆåŠ¨ç”» */
        @keyframes attackShake {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(5deg) scale(1.1); }
            50% { transform: rotate(-5deg) scale(1.1); }
            75% { transform: rotate(5deg) scale(1.1); }
            100% { transform: rotate(0deg) scale(1); }
        }
        @keyframes healGlow {
            0% { filter: brightness(1) hue-rotate(0deg); }
            50% { filter: brightness(1.3) hue-rotate(20deg); }
            100% { filter: brightness(1) hue-rotate(0deg); }
        }
        @keyframes controlBlur {
            0% { filter: grayscale(0) blur(0px); }
            50% { filter: grayscale(0.7) blur(3px); }
            100% { filter: grayscale(0) blur(0px); }
        }
        @keyframes tipFloat {
            0% { transform: translateX(-50%) translateY(0px); }
            50% { transform: translateX(-50%) translateY(-10px); }
            100% { transform: translateX(-50%) translateY(0px); }
        }
        @keyframes resultPulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* æŠ€èƒ½é‡Šæ”¾ç²’å­ç‰¹æ•ˆï¼ˆä¼ªå…ƒç´ å®ç°ï¼‰ */
        .skill-effect {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: rgba(255, 215, 0, 0.6);
            z-index: 18;
            animation: skillExplode 1s ease-out forwards;
            display: none;
        }
        @keyframes skillExplode {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.8; }
            100% { transform: scale(3); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="battle-container">
        <!-- å® ç‰©å¯¹æˆ˜åŒºåŸŸ -->
        <div class="pet-area">
            <!-- ç©å®¶å® ç‰©ï¼ˆå·¦ä¾§ï¼šå¹´ç³•ï¼‰ -->
            <div class="pet-card player-pet">
                <div class="pet-info">
                    <div class="pet-name">å¹´ç³•</div>
                    <div class="pet-level">ç­‰çº§ï¼š20</div>
                    <div class="hp-container">
                        <span class="hp-label">HP</span>
                        <div class="hp-bar">
                            <div class="hp-fill" id="playerHpFill"></div>
                        </div>
                        <span class="hp-text" id="playerHpText">120/120</span>
                    </div>
                </div>
                <img src="https://s41.ax1x.com/2025/12/09/pZuKotA.png" alt="å¹´ç³•" class="pet-img" id="playerPetImg">
            </div>

            <!-- æ•Œæ–¹å® ç‰©ï¼ˆå³ä¾§ï¼šå°å®ï¼‰ -->
            <div class="pet-card enemy-pet">
                <img src="https://s41.ax1x.com/2025/12/09/pZuKv7Q.png" alt="å°å®" class="pet-img" id="enemyPetImg">
                <div class="pet-info">
                    <div class="pet-name">å°å®</div>
                    <div class="pet-level">ç­‰çº§ï¼š20</div>
                    <div class="hp-container">
                        <span class="hp-label">HP</span>
                        <div class="hp-bar">
                            <div class="hp-fill" id="enemyHpFill"></div>
                        </div>
                        <span class="hp-text" id="enemyHpText">120/120</span>
                    </div>
                </div>
            </div>

            <!-- æŠ€èƒ½ç²’å­ç‰¹æ•ˆå®¹å™¨ -->
            <div class="skill-effect" id="skillEffect"></div>

            <!-- å›åˆæç¤º -->
            <div class="round-tip" id="roundTip">ä½ çš„å›åˆï¼é€‰æ‹©æŠ€èƒ½å‡ºå‡»ï½</div>
        </div>

        <!-- æˆ˜æ–—æ—¥å¿—åŒºåŸŸï¼ˆç§»è‡³å® ç‰©åŒºä¸‹æ–¹ã€æŠ€èƒ½æ± ä¸Šæ–¹ï¼‰ -->
        <div class="battle-log-wrapper">
            <div class="battle-log" id="battleLog">
                [ç³»ç»Ÿ] æˆ˜æ–—å¼€å§‹ï¼å¹´ç³• vs å°å®
            </div>
        </div>

        <!-- æŠ€èƒ½æ± åŒºåŸŸ -->
        <div class="skill-pool">
            <button class="skill-btn" id="skill1" data-type="attack" data-damage="18" data-pp="12">
                åˆ©çˆªçªè¢­
                <span class="skill-pp">12</span>
            </button>
            <button class="skill-btn" id="skill2" data-type="magic" data-damage="28" data-pp="8">
                é­”æ³•é£å¼¹
                <span class="skill-pp">8</span>
            </button>
            <button class="skill-btn" id="skill3" data-type="heal" data-damage="-15" data-pp="5">
                æ²»æ„ˆèˆ”æ¯›
                <span class="skill-pp">5</span>
            </button>
            <button class="skill-btn" id="skill4" data-type="control" data-damage="10" data-pp="4">
                å‚¬çœ çˆª
                <span class="skill-pp">4</span>
            </button>
        </div>

        <!-- èƒœè´Ÿæç¤ºå¼¹çª— -->
        <div class="result-modal" id="resultModal">
            <div class="result-text" id="resultText"></div>
            <button class="restart-btn" id="restartBtn">é‡æ–°å¯¹æˆ˜</button>
        </div>
    </div>

    <script>
        // 1. æ¸¸æˆæ ¸å¿ƒæ•°æ®
        const gameData = {
            // ç©å®¶å® ç‰©æ•°æ®ï¼ˆå¹´ç³•ï¼‰
            player: {
                hp: 120,
                maxHp: 120,
                level: 20,
                isStunned: false // æ˜¯å¦è¢«æ§åˆ¶ï¼ˆå‚¬çœ ï¼‰
            },
            // æ•Œæ–¹å® ç‰©æ•°æ®ï¼ˆå°å®ï¼‰
            enemy: {
                hp: 120,
                maxHp: 120,
                level: 20,
                isStunned: false
            },
            // 4ä¸ªæŠ€èƒ½çš„PPæ•°æ®
            skills: {
                skill1: { pp: 12, maxPp: 12 }, // åˆ©çˆªçªè¢­
                skill2: { pp: 8, maxPp: 8 },  // é­”æ³•é£å¼¹
                skill3: { pp: 5, maxPp: 5 },  // æ²»æ„ˆèˆ”æ¯›
                skill4: { pp: 4, maxPp: 4 }   // å‚¬çœ çˆª
            },
            isBattleEnd: false,
            currentRound: 1,
            isEnemyTurn: false // æ–°å¢ï¼šæ ‡è®°æ˜¯å¦ä¸ºæ•Œæ–¹å›åˆï¼Œé˜²æ­¢ç©å®¶ä¸­é€”æ“ä½œ
        };

        // 2. DOMå…ƒç´ è·å–
        const playerHpFill = document.getElementById('playerHpFill');
        const playerHpText = document.getElementById('playerHpText');
        const enemyHpFill = document.getElementById('enemyHpFill');
        const enemyHpText = document.getElementById('enemyHpText');
        const battleLog = document.getElementById('battleLog');
        const roundTip = document.getElementById('roundTip');
        const resultModal = document.getElementById('resultModal');
        const resultText = document.getElementById('resultText');
        const restartBtn = document.getElementById('restartBtn');
        const skillButtons = document.querySelectorAll('.skill-btn');
        const playerPetImg = document.getElementById('playerPetImg');
        const enemyPetImg = document.getElementById('enemyPetImg');
        const skillEffect = document.getElementById('skillEffect');

        // 3. åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // é‡ç½®æ‰€æœ‰æ ¸å¿ƒæ•°æ®
            gameData.player.hp = gameData.player.maxHp;
            gameData.player.isStunned = false;
            gameData.enemy.hp = gameData.enemy.maxHp;
            gameData.enemy.isStunned = false;
            gameData.isBattleEnd = false;
            gameData.currentRound = 1;
            gameData.isEnemyTurn = false; // é‡ç½®æ•Œæ–¹å›åˆæ ‡è®°

            // é‡ç½®æŠ€èƒ½PP
            Object.keys(gameData.skills).forEach(skillId => {
                gameData.skills[skillId].pp = gameData.skills[skillId].maxPp;
            });

            // æ›´æ–°æ˜¾ç¤º
            updateHpDisplay();
            updateSkillDisplay();
            clearLog();
            addLog(`[ç³»ç»Ÿ] æˆ˜æ–—å¼€å§‹ï¼å¹´ç³• vs å°å®`);
            
            // éšè—å¼¹çª—ï¼Œæ˜¾ç¤ºå›åˆæç¤º
            resultModal.style.display = 'none';
            showRoundTip('ä½ çš„å›åˆï¼é€‰æ‹©æŠ€èƒ½å‡ºå‡»ï½');

            // è§£é”æ‰€æœ‰æŠ€èƒ½æŒ‰é’®
            skillButtons.forEach(btn => {
                btn.disabled = false;
            });

            // é‡ç½®å® ç‰©å›¾ç‰‡æ ·å¼ï¼ˆæ¸…é™¤ç‰¹æ•ˆï¼‰
            playerPetImg.classList.remove('attack-effect', 'heal-effect', 'control-effect');
            enemyPetImg.classList.remove('attack-effect', 'heal-effect', 'control-effect');
        }

        // 4. æ›´æ–°HPæ˜¾ç¤º
        function updateHpDisplay() {
            // ç©å®¶HP
            const playerHpPercent = (gameData.player.hp / gameData.player.maxHp) * 100;
            playerHpFill.style.width = `${playerHpPercent}%`;
            playerHpText.textContent = `${gameData.player.hp}/${gameData.player.maxHp}`;

            // æ•Œæ–¹HP
            const enemyHpPercent = (gameData.enemy.hp / gameData.enemy.maxHp) * 100;
            enemyHpFill.style.width = `${enemyHpPercent}%`;
            enemyHpText.textContent = `${gameData.enemy.hp}/${gameData.enemy.maxHp}`;
        }

        // 5. æ›´æ–°æŠ€èƒ½PPæ˜¾ç¤º
        function updateSkillDisplay() {
            skillButtons.forEach(btn => {
                const skillId = btn.id;
                const pp = gameData.skills[skillId].pp;
                // æ›´æ–°PPæ•°å€¼
                btn.querySelector('.skill-pp').textContent = pp;
                // ç¦ç”¨æ¡ä»¶ï¼šPPä¸º0 / æˆ˜æ–—ç»“æŸ / ç©å®¶è¢«æ§åˆ¶ / æ•Œæ–¹å›åˆä¸­
                const isDisabled = pp <= 0 || gameData.isBattleEnd || gameData.player.isStunned || gameData.isEnemyTurn;
                btn.disabled = isDisabled;
            });
        }

        // 6. æ·»åŠ å¯¹æˆ˜æ—¥å¿—
        function addLog(text) {
            const time = new Date().toLocaleTimeString();
            battleLog.innerHTML += `<br>[${time}] ${text}`;
            // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
            battleLog.scrollTop = battleLog.scrollHeight;
        }

        // 7. æ¸…ç©ºæ—¥å¿—
        function clearLog() {
            battleLog.innerHTML = '[ç³»ç»Ÿ] æˆ˜æ–—å¼€å§‹ï¼å¹´ç³• vs å°å®';
        }

        // 8. æ˜¾ç¤ºå›åˆæç¤º
        function showRoundTip(text) {
            roundTip.textContent = text;
            roundTip.style.display = 'block';
            // 3ç§’åéšè—
            setTimeout(() => {
                if (!gameData.isBattleEnd) {
                    roundTip.style.display = 'none';
                }
            }, 3000);
        }

        // 9. æŠ€èƒ½é‡Šæ”¾ç‰¹æ•ˆï¼ˆå¢å¼ºç‰ˆï¼‰
        function playSkillEffect(isPlayer, skillType) {
            const targetImg = isPlayer ? enemyPetImg : playerPetImg;
            const skillEffectEl = document.getElementById('skillEffect');
            
            // å®šä½ç²’å­ç‰¹æ•ˆåˆ°ç›®æ ‡å® ç‰©ä½ç½®
            const targetRect = targetImg.getBoundingClientRect();
            const containerRect = document.querySelector('.battle-container').getBoundingClientRect();
            skillEffectEl.style.left = `${targetRect.left - containerRect.left + targetRect.width/2 - 50}px`;
            skillEffectEl.style.top = `${targetRect.top - containerRect.top + targetRect.height/2 - 50}px`;
            skillEffectEl.style.display = 'block';
            
            // ä¸åŒæŠ€èƒ½ä¸åŒç‰¹æ•ˆ
            switch (skillType) {
                case 'attack':
                    targetImg.classList.add('attack-effect');
                    skillEffectEl.style.background = 'rgba(255, 102, 0, 0.7)';
                    addLog(`ğŸ’¥ ç‰©ç†æ”»å‡»ç‰¹æ•ˆè§¦å‘ï¼`);
                    break;
                case 'magic':
                    targetImg.classList.add('attack-effect');
                    skillEffectEl.style.background = 'rgba(102, 102, 255, 0.7)';
                    addLog(`âœ¨ é­”æ³•æ”»å‡»ç‰¹æ•ˆè§¦å‘ï¼`);
                    break;
                case 'heal':
                    const selfImg = isPlayer ? playerPetImg : enemyPetImg;
                    selfImg.classList.add('heal-effect');
                    skillEffectEl.style.background = 'rgba(102, 255, 102, 0.7)';
                    addLog(`â¤ï¸ æ²»æ„ˆç‰¹æ•ˆè§¦å‘ï¼`);
                    break;
                case 'control':
                    targetImg.classList.add('control-effect');
                    skillEffectEl.style.background = 'rgba(204, 102, 255, 0.7)';
                    addLog(`ğŸ˜´ æ§åˆ¶ç‰¹æ•ˆè§¦å‘ï¼`);
                    break;
            }

            // ç§»é™¤ç‰¹æ•ˆç±»å
            setTimeout(() => {
                targetImg.classList.remove('attack-effect', 'heal-effect', 'control-effect');
                skillEffectEl.style.display = 'none';
            }, 1000);
        }

        // 10. ç©å®¶é‡Šæ”¾æŠ€èƒ½ï¼ˆä¿®å¤æ ¸å¿ƒé€»è¾‘ï¼‰
        function playerUseSkill(skillBtn) {
            // é˜²æ­¢æˆ˜æ–—ç»“æŸ/æ•Œæ–¹å›åˆ/ç©å®¶è¢«æ§åˆ¶æ—¶æ“ä½œ
            if (gameData.isBattleEnd || gameData.isEnemyTurn || gameData.player.isStunned) {
                addLog(`[æç¤º] æ— æ³•é‡Šæ”¾æŠ€èƒ½ï¼${gameData.player.isStunned ? 'ä½ è¢«æ§åˆ¶äº†' : 'å½“å‰æ˜¯æ•Œæ–¹å›åˆ'}`);
                return;
            }

            const skillId = skillBtn.id;
            const skill = gameData.skills[skillId];
            
            // æ£€æŸ¥PPæ˜¯å¦è¶³å¤Ÿ
            if (skill.pp <= 0) {
                addLog(`[æç¤º] ${skillBtn.textContent.trim().split('\n')[0]}çš„PPå·²è€—å°½ï¼`);
                return;
            }

            const damage = parseInt(skillBtn.dataset.damage);
            const skillType = skillBtn.dataset.type;

            // æ ‡è®°ä¸ºæ•Œæ–¹å›åˆï¼Œé˜²æ­¢ç©å®¶é‡å¤æ“ä½œ
            gameData.isEnemyTurn = true;
            // ä¸´æ—¶ç¦ç”¨æ‰€æœ‰æŠ€èƒ½æŒ‰é’®ï¼ˆæ•Œæ–¹å›åˆä¸­ï¼‰
            skillButtons.forEach(btn => btn.disabled = true);

            // æ‰£PP
            skill.pp -= 1;
            updateSkillDisplay();

            // æ’­æ”¾æŠ€èƒ½ç‰¹æ•ˆ
            playSkillEffect(true, skillType);

            // æ‰§è¡ŒæŠ€èƒ½æ•ˆæœ
            switch (skillType) {
                case 'attack': // ç‰©ç†æ”»å‡»
                    gameData.enemy.hp = Math.max(0, gameData.enemy.hp - damage);
                    addLog(`[ä½ çš„å›åˆ] å¹´ç³•ä½¿ç”¨äº†${skillBtn.textContent.trim().split('\n')[0]}ï¼Œé€ æˆ${damage}ç‚¹ç‰©ç†ä¼¤å®³ï¼`);
                    break;
                case 'magic': // é­”æ³•æ”»å‡»
                    gameData.enemy.hp = Math.max(0, gameData.enemy.hp - damage);
                    addLog(`[ä½ çš„å›åˆ] å¹´ç³•ä½¿ç”¨äº†${skillBtn.textContent.trim().split('\n')[0]}ï¼Œé€ æˆ${damage}ç‚¹é­”æ³•ä¼¤å®³ï¼`);
                    break;
                case 'heal': // å›è¡€
                    gameData.player.hp = Math.min(gameData.player.maxHp, gameData.player.hp - damage);
                    addLog(`[ä½ çš„å›åˆ] å¹´ç³•ä½¿ç”¨äº†${skillBtn.textContent.trim().split('\n')[0]}ï¼Œæ¢å¤äº†${-damage}ç‚¹HPï¼`);
                    break;
                case 'control': // æ§åˆ¶ï¼ˆå‚¬çœ ï¼‰
                    gameData.enemy.isStunned = true;
                    gameData.enemy.hp = Math.max(0, gameData.enemy.hp - damage);
                    addLog(`[ä½ çš„å›åˆ] å¹´ç³•ä½¿ç”¨äº†${skillBtn.textContent.trim().split('\n')[0]}ï¼Œé€ æˆ${damage}ç‚¹ä¼¤å®³å¹¶å‚¬çœ äº†å°å®ï¼`);
                    break;
            }

            // æ›´æ–°HP
            updateHpDisplay();

            // æ£€æŸ¥æ•Œæ–¹æ˜¯å¦æˆ˜è´¥
            if (gameData.enemy.hp <= 0) {
                endBattle(true);
                gameData.isEnemyTurn = false; // é‡ç½®å›åˆæ ‡è®°
                return;
            }

            // æ•Œæ–¹å›åˆï¼ˆå»¶è¿Ÿ1.5ç§’ï¼Œæ¨¡æ‹Ÿæ€è€ƒï¼‰
            setTimeout(enemyTurn, 1500);
        }

        // 11. æ•Œæ–¹å›åˆï¼ˆä¿®å¤æŠ€èƒ½å¤±æ•ˆBUGï¼‰
        function enemyTurn() {
            if (gameData.isBattleEnd) {
                gameData.isEnemyTurn = false;
                updateSkillDisplay(); // è§£é”æŠ€èƒ½æŒ‰é’®
                return;
            }

            showRoundTip('å¯¹æ‰‹çš„å›åˆï¼å°å®å‡†å¤‡å‡ºæ‹›ï½');

            // å¦‚æœè¢«å‚¬çœ ï¼Œè·³è¿‡å›åˆ
            if (gameData.enemy.isStunned) {
                addLog(`[æ•Œæ–¹å›åˆ] å°å®è¢«å‚¬çœ äº†ï¼Œæ— æ³•è¡ŒåŠ¨ï¼`);
                gameData.enemy.isStunned = false; // è§£é™¤å‚¬çœ 
                
                // é‡ç½®å›åˆæ ‡è®°ï¼Œè§£é”æŠ€èƒ½æŒ‰é’®
                gameData.isEnemyTurn = false;
                // æ¢å¤ç©å®¶æŠ€èƒ½æŒ‰é’®ï¼ˆæ’é™¤PPè€—å°½çš„ï¼‰
                updateSkillDisplay();
                showRoundTip('ä½ çš„å›åˆï¼é€‰æ‹©æŠ€èƒ½å‡ºå‡»ï½');
                return;
            }

            // æ•Œæ–¹4ä¸ªæŠ€èƒ½æ± ï¼ˆæ·»åŠ PPæ¶ˆè€—é€»è¾‘ï¼‰
            const enemySkills = [
                { name: 'é‡è›®å†²æ’', type: 'attack', damage: 16, pp: 12, maxPp: 12 },
                { name: 'æš—å½±çƒ', type: 'magic', damage: 26, pp: 8, maxPp: 8 },
                { name: 'è‡ªæ„ˆ', type: 'heal', damage: -13, pp: 5, maxPp: 5 },
                { name: 'æå“çˆª', type: 'control', damage: 8, pp: 4, maxPp: 4 }
            ];

            // ç­›é€‰å¯ç”¨æŠ€èƒ½ï¼ˆPP>0ï¼‰
            const availableSkills = enemySkills.filter(skill => skill.pp > 0);
            let randomSkill;
            
            // å¦‚æœæ— å¯ç”¨æŠ€èƒ½ï¼Œæ•Œæ–¹é˜²å¾¡
            if (availableSkills.length === 0) {
                addLog(`[æ•Œæ–¹å›åˆ] å°å®çš„æŠ€èƒ½PPå·²è€—å°½ï¼Œåªèƒ½é˜²å¾¡ï¼`);
                // é‡ç½®å›åˆæ ‡è®°ï¼Œè§£é”æŠ€èƒ½æŒ‰é’®
                gameData.isEnemyTurn = false;
                updateSkillDisplay();
                showRoundTip('ä½ çš„å›åˆï¼é€‰æ‹©æŠ€èƒ½å‡ºå‡»ï½');
                return;
            } else {
                randomSkill = availableSkills[Math.floor(Math.random() * availableSkills.length)];
                // æ•Œæ–¹æ‰£PP
                randomSkill.pp -= 1;
            }

            // æ’­æ”¾æŠ€èƒ½ç‰¹æ•ˆ
            playSkillEffect(false, randomSkill.type);

            // æ‰§è¡Œæ•Œæ–¹æŠ€èƒ½æ•ˆæœ
            switch (randomSkill.type) {
                case 'attack':
                    gameData.player.hp = Math.max(0, gameData.player.hp - randomSkill.damage);
                    addLog(`[æ•Œæ–¹å›åˆ] å°å®ä½¿ç”¨äº†${randomSkill.name}ï¼Œé€ æˆ${randomSkill.damage}ç‚¹ç‰©ç†ä¼¤å®³ï¼`);
                    break;
                case 'magic':
                    gameData.player.hp = Math.max(0, gameData.player.hp - randomSkill.damage);
                    addLog(`[æ•Œæ–¹å›åˆ] å°å®ä½¿ç”¨äº†${randomSkill.name}ï¼Œé€ æˆ${randomSkill.damage}ç‚¹é­”æ³•ä¼¤å®³ï¼`);
                    break;
                case 'heal':
                    gameData.enemy.hp = Math.min(gameData.enemy.maxHp, gameData.enemy.hp - randomSkill.damage);
                    addLog(`[æ•Œæ–¹å›åˆ] å°å®ä½¿ç”¨äº†${randomSkill.name}ï¼Œæ¢å¤äº†${-randomSkill.damage}ç‚¹HPï¼`);
                    break;
                case 'control':
                    gameData.player.isStunned = true;
                    gameData.player.hp = Math.max(0, gameData.player.hp - randomSkill.damage);
                    addLog(`[æ•Œæ–¹å›åˆ] å°å®ä½¿ç”¨äº†${randomSkill.name}ï¼Œé€ æˆ${randomSkill.damage}ç‚¹ä¼¤å®³å¹¶æå“äº†å¹´ç³•ï¼`);
                    break;
            }

            // æ›´æ–°HP
            updateHpDisplay();

            // æ£€æŸ¥ç©å®¶æ˜¯å¦æˆ˜è´¥
            if (gameData.player.hp <= 0) {
                endBattle(false);
                gameData.isEnemyTurn = false;
                return;
            }

            // é‡ç½®å›åˆæ ‡è®°ï¼Œè§£é”ç©å®¶æŠ€èƒ½æŒ‰é’®
            gameData.isEnemyTurn = false;
            // æ¢å¤æŠ€èƒ½æŒ‰é’®ï¼ˆæ ¹æ®PPå’Œæ§åˆ¶çŠ¶æ€ï¼‰
            updateSkillDisplay();

            // æ˜¾ç¤ºç©å®¶å›åˆæç¤º
            setTimeout(() => {
                showRoundTip(gameData.player.isStunned ? 'ä½ è¢«æ§åˆ¶äº†ï¼Œæœ¬å›åˆæ— æ³•è¡ŒåŠ¨ï¼' : 'ä½ çš„å›åˆï¼é€‰æ‹©æŠ€èƒ½å‡ºå‡»ï½');
                
                // å¦‚æœç©å®¶è¢«æ§åˆ¶ï¼Œè‡ªåŠ¨è·³è¿‡å›åˆ
                if (gameData.player.isStunned) {
                    addLog(`[æç¤º] ä½ è¢«æ§åˆ¶äº†ï¼Œè·³è¿‡æœ¬å›åˆï¼`);
                    gameData.player.isStunned = false; // è§£é™¤æ§åˆ¶
                    setTimeout(() => {
                        gameData.isEnemyTurn = true;
                        skillButtons.forEach(btn => btn.disabled = true);
                        setTimeout(enemyTurn, 1000);
                    }, 2000);
                }
            }, 1000);

            // å›åˆæ•°+1
            gameData.currentRound++;
        }

        // 12. ç»“æŸæˆ˜æ–—
        function endBattle(isPlayerWin) {
            gameData.isBattleEnd = true;
            gameData.isEnemyTurn = false;
            // ç¦ç”¨æ‰€æœ‰æŠ€èƒ½
            skillButtons.forEach(btn => btn.disabled = true);
            // æ˜¾ç¤ºç»“æœå¼¹çª—
            resultModal.style.display = 'flex';
            if (isPlayerWin) {
                resultText.textContent = 'æ­å–œï¼å¹´ç³•èµ¢äº†ï½';
                addLog(`[ç³»ç»Ÿ] æˆ˜æ–—ç»“æŸï¼å¹´ç³•å‡»è´¥äº†å°å®ï¼Œè·å¾—èƒœåˆ©ï¼`);
            } else {
                resultText.textContent = 'å¾ˆé—æ†¾ï¼å¹´ç³•è¾“äº†ï½';
                addLog(`[ç³»ç»Ÿ] æˆ˜æ–—ç»“æŸï¼å°å®å‡»è´¥äº†å¹´ç³•ï¼ŒæŒ‘æˆ˜å¤±è´¥ï¼`);
            }
        }

        // 13. ç»‘å®šäº‹ä»¶
        // æŠ€èƒ½æŒ‰é’®ç‚¹å‡»
        skillButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                playerUseSkill(btn);
            });
        });
        // é‡æ–°å¼€å§‹æŒ‰é’®
        restartBtn.addEventListener('click', initGame);

        // åˆå§‹åŒ–æ¸¸æˆ
        window.onload = initGame;
    </script>
</body>
</html>